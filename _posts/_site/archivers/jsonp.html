<h2 id="发送请求的方式">发送请求的方式</h2>
<p>GET请求-POST请求</p>

<h2 id="发送请求的主要步骤">发送请求的主要步骤</h2>

<p><strong>GET请求</strong></p>

<p>1）创建请求对象（XMLHTTPRequest）注意兼容性问题</p>

<p>2）设置请求方法和路径（open方法）</p>

<p>3）发送请求（send方法）</p>

<p>4）监听网络请求的状态（onreadystateschange）</p>

<p>5）处理服务器返回的数据（先判断请求是否成功再解析）
    注意点：参数拼接在请求路径的后面，放在url中传递，因为部分浏览器对URL的长度和大小有限制，因此不能黑夜GET请求发送较大的数据，且安全性较差。</p>

<p><strong>POST请求</strong></p>

<p>1）创建请求对象（XMLHTTPRequest）注意兼容性问题</p>

<p>2）设置请求方法和路径（open方法）</p>

<p>3）设置请求头部信息（setRequestHeader）</p>

<p>4）发送请求（send方法，参数放在该方法中传递）</p>

<p>5）监听网络请求的状态（onreadystateschange）</p>

<p>6）处理服务器返回的数据（先判断请求是否成功再解析）
    注意点：注意设置请求头的位置（应该在open方法和send方法中间），参数以固定的格式放在send方法中传递，相对安全。</p>

<h1 id="跨域请求的实现原理">跨域请求的实现原理</h1>

<h2 id="简单说明">简单说明</h2>

<p>01 Ajax不能实现跨域请求（不能跨服务器请求，比如我们自己的服务器不能请求百度网页，因为域不一样）</p>

<p>02 要实现跨域发送请求可以借助script标签来实现，因为这个标签中的src可以引入外部的文件。</p>

<h2 id="实现原理">实现原理</h2>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="nt">&lt;script&gt;</span>
        <span class="kd">function</span> <span class="nx">show</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="nx">show</span><span class="p">({</span><span class="na">name</span><span class="p">:</span><span class="s2">"wendingding"</span><span class="p">});</span>
    <span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>##代码说明：</p>

<p>001 如果在页面中提供两个script标签，第一个标签中声明一个show函数</p>

<p>002 该函数接收一个对象作为参数，函数的内容是打印传递的参数</p>

<p>003 根据js的语法规则，在第二个script中我们可以直接调用show方法</p>

<p>004 又因为script标签中的src属性允许我们把脚本的内容提取到一个单独的js文件中，而在HTML页面中只需要通过src导入即可</p>

<p>005 因此，我们可以把show方法的调用写到一个单独的js文件中，然后导入</p>

<p>006 例如：<script src="show.js"></script>，作用是把show.js中的代码拷贝到标签中执行</p>

<h2 id="核心实现">核心实现</h2>

<p>基于script标签和scr属性节点的特点，我们可以考虑在页面中利用此特性来实现跨域请求。</p>

<p>（1）在页面中提供第一个script标签，在该标签中声明函数（设置形参）</p>

<p>（2）提供第二个script标签，把需要跨域访问的路径设置为该标签的src</p>

<p>（3）在对应的路径中，返回固定格式的JSON数据【函数名称(对象)】</p>

<p>（4）在声明的函数中对形参进行处理（形参就是跨域请求返回的数据）</p>

<h2 id="代码实例">代码实例</h2>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span>
        <span class="c1">// 数据处理方法</span>
        <span class="kd">function</span> <span class="nx">json2str</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">data</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">data</span><span class="p">){</span>
                <span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="o">+</span><span class="s2">"="</span><span class="o">+</span><span class="nx">data</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
            <span class="p">}</span>
            <span class="c1">// 不能直接将中文提交给服务器, 中文需要编码之后再提交</span>
            <span class="k">return</span> <span class="nb">encodeURI</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">"&amp;"</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="cm">/*
         url: 跨域访问的地址
         注意点: url不能写死, 否则没有复用性
         data: 参数
         注意点: 参数也不能写死
         */</span>
        <span class="kd">function</span> <span class="nx">jsonp</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">temp</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#jsonpScript"</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">temp</span><span class="p">){</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">temp</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// 随机生成一个函数名称, 避免冲突</span>
            <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"XMG_"</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()).</span><span class="nx">replace</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">""</span><span class="p">);</span>
            <span class="c1">// 指定回调函数名称(本地创建一个函数作为回调函数)</span>
            <span class="nb">window</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">fn</span><span class="p">;</span>
            <span class="c1">// 指定回调函数的名称(告诉服务器跨域访问之后回调的函数名称)</span>
            <span class="nx">options</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">cbName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
            <span class="c1">// 格式化参数</span>
            <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">json2str</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
            <span class="c1">// 创建一个script标签</span>
            <span class="kd">var</span> <span class="nx">oScript</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"script"</span><span class="p">);</span>
            <span class="nx">oScript</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"jsonpScript"</span><span class="p">);</span>
            <span class="c1">// 设置script标签的src属性</span>
            <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="o">+</span><span class="s2">"?"</span><span class="o">+</span><span class="nx">str</span><span class="p">;</span>
            <span class="nx">oScript</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"src"</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
            <span class="c1">// 注意点: 创建好了script标签, 如果没有添加到界面中, 是不会请求src</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">oScript</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="c1">// 1.拿到输入框</span>
            <span class="kd">var</span> <span class="nx">oInput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"input"</span><span class="p">);</span>
            <span class="c1">// 2.监听用户输入事件</span>
            <span class="nx">oInput</span><span class="p">.</span><span class="nx">onkeyup</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="c1">// 获取用户输入的内容</span>
                <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">oInput</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
                <span class="c1">// 跨域访问</span>
                <span class="nx">jsonp</span><span class="p">({</span>
                        <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su"</span><span class="p">,</span>
                        <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">"wd"</span><span class="p">:</span> <span class="nx">text</span>
                        <span class="p">},</span>
                        <span class="s2">"cbName"</span><span class="p">:</span> <span class="s2">"cb"</span><span class="p">,</span>
                        <span class="s2">"fn"</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
                            <span class="c1">// 1.创建ul</span>
                            <span class="kd">var</span> <span class="nx">oUl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"ul"</span><span class="p">)</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"ul"</span><span class="p">);</span>
                            <span class="nx">oUl</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
                            <span class="c1">// 2.遍历对象创建li</span>
                            <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">s</span><span class="p">;</span>
                            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                                <span class="c1">// 创建li</span>
                                <span class="kd">var</span> <span class="nx">oLi</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"li"</span><span class="p">);</span>
                                <span class="nx">oLi</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                                <span class="c1">// 将创建的li添加到ul中</span>
                                <span class="nx">oUl</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">oLi</span><span class="p">);</span>
                            <span class="p">}</span>
                            <span class="c1">// 3.将ul添加到body中</span>
                            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">oUl</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<h2 id="效果展示">效果展示</h2>

<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Document</title>
    <style>
        #textId {
            width: 400px;
            height: 30px;
            line-height: 30px;
            padding-left: 10px;
            font-size: 16px;
        }
        .box {
            width: 400px;
            margin: 30px auto 100px;
            height: 30px;
            position: relative;
        }
        .box ul {
            margin: 0;
            width: 400px;
            max-height: 150px;
            overflow-y: auto;
            list-style: none;
            padding-left: 10px;
            border: 1px solid #eee;
            border-top: none;
            background-color: #fff;
            position: absolute;
            top: 30px;
            left: 0;
        }
        .box ul li {
            height: 30px;
            line-height: 30px;
            color: skyblue;
        }
    </style>
</head>

<body>
    <div class="box">
        <input type="text" placeholder="请输入搜索内容" id="textId" />
    </div>
    <script>
        function fn(obj) {
            var oul = document.getElementById("tempUl");
            if(oul) oul.parentNode.removeChild(oul);
            oul=document.createElement("ul");
            oul.setAttribute("id","tempUl");
            document.querySelector(".box").appendChild(oul);
            var arrM = obj["s"];
            for (var i = 0; i < arrM.length; i++) {
                var oli = document.createElement("li");
                oli.innerText = arrM[i];
                oul.appendChild(oli);
            }
        }
    </script>
    <script>
        var oText = document.querySelector("#textId");
        oText.onkeyup = function() {
            var oScript = document.getElementsByClassName("testClass")[0];
            if (oScript) oScript.parentNode.removeChild(oScript);
            // 创建script标签
            oScript = document.createElement("script");
            // 设置src属性
            oScript.setAttribute("src", "https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd=" + oText.value + "&cb=fn");
            oScript.className = "testClass";
            // 把标签添加到到页面
            document.body.appendChild(oScript);
        };
    </script>
</body>

</html>
